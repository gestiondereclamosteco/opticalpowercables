<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    
        <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
    
            <meta name="viewport" content="width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
            <style>
                #map_668f89319b27fe6ccb41764899ce32f6 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>
        
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.1.0/leaflet.markercluster.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.1.0/MarkerCluster.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.1.0/MarkerCluster.Default.css"/>
</head>
<body>
    
    
        <script>
          console.log("Iniciando script de control...");

          function waitForFirebase(callback, maxAttempts = 50, attempts = 0) {
            if (typeof firebase !== 'undefined' && firebase.app) {
              console.log("Firebase está disponible, ejecutando callback...");
              callback();
            } else if (attempts >= maxAttempts) {
              console.error("No se pudo cargar Firebase después de", maxAttempts, "intentos. Verifica tu conexión a internet.");
              alert("No se pudo conectar con la base de datos. Por favor, verifica tu conexión a internet y recarga la página.");
              document.getElementById('loading-overlay').style.display = 'none';
            } else {
              console.log("Esperando a que Firebase se cargue... Intento", attempts + 1);
              setTimeout(() => waitForFirebase(callback, maxAttempts, attempts + 1), 100);
            }
          }

          const firebaseConfig = {
            apiKey: "AIzaSyDeNZyU0kM4fbmgljtxHggfu8LSD9sTdO8",
            authDomain: "mapareclamos-65d2a.firebaseapp.com",
            databaseURL: "https://mapareclamos-65d2a-default-rtdb.firebaseio.com",
            projectId: "mapareclamos-65d2a",
            storageBucket: "mapareclamos-65d2a.firebasestorage.app",
            messagingSenderId: "381859152917",
            appId: "1:381859152917:web:d452973d364da596bc3a1c",
            measurementId: "G-PPNRM8D0ET"
          };

          let database = null;
          let map = null;
          let tempMarker = null;
          let pendingActions = [];
          let markerCluster = null;
          let currentPopup = null;
          let isClosingPopup = false;
          let isPendingListExpanded = false;
          let isNoMapeadasListExpanded = false;
          let isFiltersExpanded = false;
          let fotosPorCaso = {"5862": {"images": ["https://drive.google.com/thumbnail?id=1VA-8kueapnH4zjesds3FbN0zc2VWk0Jp", "https://drive.google.com/thumbnail?id=1tuoAyn3kSdO0PxJsqCiAFgrqcfe2QJkt", "https://drive.google.com/thumbnail?id=1NaEgNBB000iMcV3yQlzN_0hsxl48YrAp", "https://drive.google.com/thumbnail?id=1edOLM4jqlhjfcMGHoQ4W0lmk34V2BwXI"], "folder": "https://drive.google.com/drive/folders/1CovMXcoT_HSo0GXJNh1qNlyT6iAH_OMh"}, "5894": {"images": ["https://drive.google.com/thumbnail?id=1dX4ILuMGhlZvcuXzPUX8bJ9HtZSJ9Cke", "https://drive.google.com/thumbnail?id=1lCbdPDOQrWrKaD-qckvzvhnpFAqQSnvj", "https://drive.google.com/thumbnail?id=1I5VwfO6htYdCDqrkoeUGJ7RtC240dICA"], "folder": "https://drive.google.com/drive/folders/1toatmOpeIhgooypi7oZ7zxTkgdLjV_ze"}, "4238": {"images": ["https://drive.google.com/thumbnail?id=11fdvJuumHDvkc3SUx_Wz02B1se_sVJwm", "https://drive.google.com/thumbnail?id=1EyoeYd1uqZB2J2RBOimatCDNgaMfXdlA", "https://drive.google.com/thumbnail?id=1YFH4MBWiu8H-3Et2ciDBLtrXibCK7tvu"], "folder": "https://drive.google.com/drive/folders/1NbmoxM9fWGqGyGAFCs1raNJPq8_5mkYH"}, "6262": {"images": ["https://drive.google.com/thumbnail?id=1obOzBZzAXgZBgyZ-ZRiLFHfJSEf0Po5v", "https://drive.google.com/thumbnail?id=1ersaeFyeEZM5pMbZZy2eiljMG8kjrhqs"], "folder": "https://drive.google.com/drive/folders/1Z4In2n3xmtxYUeFGYdUW47QON9Vi36Wq"}, "6557": {"images": ["https://drive.google.com/thumbnail?id=1K1XGzXsByw30SxwKgGk5-Gzy-5_UHk72"], "folder": "https://drive.google.com/drive/folders/1IFeJe22vngi-GwQYOURUTqbjmwopyLW6"}, "6568": {"images": ["https://drive.google.com/thumbnail?id=14Cea2SSC83J3k4B8fApCNxK0zwGMPPwe", "https://drive.google.com/thumbnail?id=1ymaRC3Z_FT3gKpboh4W-F26FhlNq18cZ"], "folder": "https://drive.google.com/drive/folders/1re49rov77tl-aTwojOBnAIY5oF-Wk-MG"}, "6569": {"images": ["https://drive.google.com/thumbnail?id=1DmYBFWxKfrQ9Io0lliON9S44SNSRuaW_", "https://drive.google.com/thumbnail?id=1piUKgb6pse5AcFbufTLJsJ3DtwwVAIZ1"], "folder": "https://drive.google.com/drive/folders/1Un93_iYsZp-morssxKjMvBUsiCEKWE5T"}};
          let allPuntos = [{"direccion": "CHARCAS 3715", "lat": -34.588033, "lng": -58.417181, "caso": "5862", "comuna": "14", "ot": "806976061", "observaciones": "Cable en panza Cable cortado", "popup_content": "\n        <div style='width: 200px; font: 12px Arial;' data-caso=\"5862\" data-comuna=\"14\">\n            <b>Direcci\u00f3n:</b> CHARCAS 3715<br>\n            <b>Comuna:</b> 14<br>\n            <b>OT:</b> 806976061<br>\n            <b>Observaciones:</b><br>Cable en panza Cable\ncortado<br>\n            <hr style=\"margin: 3px 0;\">\n            <b>Operaci\u00f3n:</b> Palermo<br>\n            <b>Zona:</b> Capital Sur<br>\n            \n            <hr style=\"margin: 3px 0;\">\n            <b>Caso:</b> 5862<br>\n            <br><b><a href=\"#\" onclick=\"mostrarFotos('5862'); return false;\" style=\"font-size: 14px;\">Ver Fotos</a></b><br>\n            <b>Ver en Google Maps:</b> <a href=\"https://www.google.com/maps?q=-34.588033,-58.417181\" target=\"_blank\">Abrir</a><br>\n            <br><b><a href=\"https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform\" target=\"_blank\" onclick=\"window.cerrarReclamo('5862');\" style=\"font-size: 14px;\">CERRAR RECLAMO</a></b>\n        </div>\n        ", "color": "blue", "fecha_reclamo": "5/26/2025", "operacion": "Palermo", "zona": "Capital Sur"}, {"direccion": "ALBARELLOS AV. 3100", "lat": -34.579243, "lng": -58.512533, "caso": "5894", "comuna": "12", "ot": "807045500", "observaciones": "No coinciden las fotos cargadas en el form con el reclamo original", "popup_content": "\n        <div style='width: 200px; font: 12px Arial;' data-caso=\"5894\" data-comuna=\"12\">\n            <b>Direcci\u00f3n:</b> ALBARELLOS AV. 3100<br>\n            <b>Comuna:</b> 12<br>\n            <b>OT:</b> 807045500<br>\n            <b>Observaciones:</b><br>No coinciden las fotos\ncargadas en el form con\nel reclamo original<br>\n            <hr style=\"margin: 3px 0;\">\n            <b>Operaci\u00f3n:</b> Paternal<br>\n            <b>Zona:</b> Capital Norte<br>\n            \n            <hr style=\"margin: 3px 0;\">\n            <b>Caso:</b> 5894<br>\n            <br><b><a href=\"#\" onclick=\"mostrarFotos('5894'); return false;\" style=\"font-size: 14px;\">Ver Fotos</a></b><br>\n            <b>Ver en Google Maps:</b> <a href=\"https://www.google.com/maps?q=-34.579243,-58.512533\" target=\"_blank\">Abrir</a><br>\n            <br><b><a href=\"https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform\" target=\"_blank\" onclick=\"window.cerrarReclamo('5894');\" style=\"font-size: 14px;\">CERRAR RECLAMO</a></b>\n        </div>\n        ", "color": "blue", "fecha_reclamo": "5/27/2025", "operacion": "Paternal", "zona": "Capital Norte"}, {"direccion": "GUATEMALA 5527", "lat": -34.580805, "lng": -58.431302, "caso": "4238", "comuna": "14", "ot": "807130137", "observaciones": "Las fotos que cargaron en el form no coinciden con las originales", "popup_content": "\n        <div style='width: 200px; font: 12px Arial;' data-caso=\"4238\" data-comuna=\"14\">\n            <b>Direcci\u00f3n:</b> GUATEMALA 5527<br>\n            <b>Comuna:</b> 14<br>\n            <b>OT:</b> 807130137<br>\n            <b>Observaciones:</b><br>Las fotos que cargaron en\nel form no coinciden con\nlas originales<br>\n            <hr style=\"margin: 3px 0;\">\n            <b>Operaci\u00f3n:</b> Palermo<br>\n            <b>Zona:</b> Capital Sur<br>\n            \n            <hr style=\"margin: 3px 0;\">\n            <b>Caso:</b> 4238<br>\n            <br><b><a href=\"#\" onclick=\"mostrarFotos('4238'); return false;\" style=\"font-size: 14px;\">Ver Fotos</a></b><br>\n            <b>Ver en Google Maps:</b> <a href=\"https://www.google.com/maps?q=-34.580805,-58.431302\" target=\"_blank\">Abrir</a><br>\n            <br><b><a href=\"https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform\" target=\"_blank\" onclick=\"window.cerrarReclamo('4238');\" style=\"font-size: 14px;\">CERRAR RECLAMO</a></b>\n        </div>\n        ", "color": "blue", "fecha_reclamo": "6/2/2025", "operacion": "Palermo", "zona": "Capital Sur"}, {"direccion": "MIGUELETES 1330", "lat": -34.562841, "lng": -58.440291, "caso": "6262", "comuna": "14", "ot": "807789707", "observaciones": "Cables en panza", "popup_content": "\n        <div style='width: 200px; font: 12px Arial;' data-caso=\"6262\" data-comuna=\"14\">\n            <b>Direcci\u00f3n:</b> MIGUELETES 1330<br>\n            <b>Comuna:</b> 14<br>\n            <b>OT:</b> 807789707<br>\n            <b>Observaciones:</b><br>Cables en panza<br>\n            <hr style=\"margin: 3px 0;\">\n            <b>Operaci\u00f3n:</b> Colegiales<br>\n            <b>Zona:</b> Capital Norte<br>\n            \n            <hr style=\"margin: 3px 0;\">\n            <b>Caso:</b> 6262<br>\n            <br><b><a href=\"#\" onclick=\"mostrarFotos('6262'); return false;\" style=\"font-size: 14px;\">Ver Fotos</a></b><br>\n            <b>Ver en Google Maps:</b> <a href=\"https://www.google.com/maps?q=-34.562841,-58.440291\" target=\"_blank\">Abrir</a><br>\n            <br><b><a href=\"https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform\" target=\"_blank\" onclick=\"window.cerrarReclamo('6262');\" style=\"font-size: 14px;\">CERRAR RECLAMO</a></b>\n        </div>\n        ", "color": "blue", "fecha_reclamo": "6/25/2025", "operacion": "Colegiales", "zona": "Capital Norte"}, {"direccion": "ALBERDI, JUAN BAUTISTA AV. 1091", "lat": -34.62289, "lng": -58.443538, "caso": "6557", "comuna": "6", "ot": "Pedido a ADM", "observaciones": "Verificar si la linga panseada es nuestra y ver con pablo como resolverlo", "popup_content": "\n        <div style='width: 248px; font: 12px Arial;' data-caso=\"6557\" data-comuna=\"6\">\n            <b>Direcci\u00f3n:</b> ALBERDI, JUAN BAUTISTA AV. 1091<br>\n            <b>Comuna:</b> 6<br>\n            <b>OT:</b> Pedido a ADM<br>\n            <b>Observaciones:</b><br>Verificar si la linga panseada\nes nuestra y ver con pablo como\nresolverlo<br>\n            <hr style=\"margin: 3px 0;\">\n            <b>Operaci\u00f3n:</b> Boedo<br>\n            <b>Zona:</b> Capital Sur<br>\n            \n            <hr style=\"margin: 3px 0;\">\n            <b>Caso:</b> 6557<br>\n            <br><b><a href=\"#\" onclick=\"mostrarFotos('6557'); return false;\" style=\"font-size: 14px;\">Ver Fotos</a></b><br>\n            <b>Ver en Google Maps:</b> <a href=\"https://www.google.com/maps?q=-34.62289,-58.443538\" target=\"_blank\">Abrir</a><br>\n            <br><b><a href=\"https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform\" target=\"_blank\" onclick=\"window.cerrarReclamo('6557');\" style=\"font-size: 14px;\">CERRAR RECLAMO</a></b>\n        </div>\n        ", "color": "blue", "fecha_reclamo": "8/4/2025", "operacion": "Boedo", "zona": "Capital Sur"}, {"direccion": "Carlos E. Pellegrini 6030", "lat": -34.564505, "lng": -58.504789, "caso": "6568", "comuna": "12", "ot": "ICD30313541 ", "observaciones": "Tendido a muy baja altura se solicita retiro o levantarlo", "popup_content": "\n        <div style='width: 200px; font: 12px Arial;' data-caso=\"6568\" data-comuna=\"12\">\n            <b>Direcci\u00f3n:</b> Carlos E. Pellegrini 6030<br>\n            <b>Comuna:</b> 12<br>\n            <b>OT:</b> ICD30313541 <br>\n            <b>Observaciones:</b><br>Tendido a muy baja altura\nse solicita retiro o\nlevantarlo<br>\n            <hr style=\"margin: 3px 0;\">\n            <b>Operaci\u00f3n:</b> Paternal<br>\n            <b>Zona:</b> Capital Norte<br>\n            \n            <hr style=\"margin: 3px 0;\">\n            <b>Caso:</b> 6568<br>\n            <br><b><a href=\"#\" onclick=\"mostrarFotos('6568'); return false;\" style=\"font-size: 14px;\">Ver Fotos</a></b><br>\n            <b>Ver en Google Maps:</b> <a href=\"https://www.google.com/maps?q=-34.564505,-58.504789\" target=\"_blank\">Abrir</a><br>\n            <br><b><a href=\"https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform\" target=\"_blank\" onclick=\"window.cerrarReclamo('6568');\" style=\"font-size: 14px;\">CERRAR RECLAMO</a></b>\n        </div>\n        ", "color": "blue", "fecha_reclamo": "8/5/2025", "operacion": "Paternal", "zona": "Capital Norte"}, {"direccion": "CAMPANA 382", "lat": -34.628022, "lng": -58.476505, "caso": "6569", "comuna": "10", "ot": "Pendiente de ADM", "observaciones": "Tendido a baja altura", "popup_content": "\n        <div style='width: 200px; font: 12px Arial;' data-caso=\"6569\" data-comuna=\"10\">\n            <b>Direcci\u00f3n:</b> CAMPANA 382<br>\n            <b>Comuna:</b> 10<br>\n            <b>OT:</b> Pendiente de ADM<br>\n            <b>Observaciones:</b><br>Tendido a baja altura<br>\n            <hr style=\"margin: 3px 0;\">\n            <b>Operaci\u00f3n:</b> Devoto<br>\n            <b>Zona:</b> Capital Norte<br>\n            \n            <hr style=\"margin: 3px 0;\">\n            <b>Caso:</b> 6569<br>\n            <br><b><a href=\"#\" onclick=\"mostrarFotos('6569'); return false;\" style=\"font-size: 14px;\">Ver Fotos</a></b><br>\n            <b>Ver en Google Maps:</b> <a href=\"https://www.google.com/maps?q=-34.628022,-58.476505\" target=\"_blank\">Abrir</a><br>\n            <br><b><a href=\"https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform\" target=\"_blank\" onclick=\"window.cerrarReclamo('6569');\" style=\"font-size: 14px;\">CERRAR RECLAMO</a></b>\n        </div>\n        ", "color": "blue", "fecha_reclamo": "8/6/2025", "operacion": "Devoto", "zona": "Capital Norte"}];
          let selectedMarker = null;
          let closedCases = {};
          let routeLayer = null;
          let isRouteVisible = false;
          const recorrido = [[-34.588033, -58.417181], [-34.580805, -58.431302], [-34.562841, -58.440291], [-34.564505, -58.504789], [-34.579243, -58.512533], [-34.628022, -58.476505], [-34.62289, -58.443538]];

          waitForFirebase(function() {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();

            database.ref('closedCases').once('value', (snapshot) => {
              closedCases = snapshot.val() || {};
              console.log('closedCases cargados desde Firebase:', closedCases);
              filtrarPorPrioridad();
              document.getElementById('loading-overlay').style.display = 'none';
            });
          });

          window.cerrarReclamo = function(caso) {
            if (!database) {
              console.error("Base de datos no inicializada. Espera a que Firebase se cargue.");
              return;
            }
            console.log('Cerrando reclamo para el caso:', caso);
            closedCases[caso] = true;

            database.ref('closedCases').set(closedCases, (error) => {
              if (error) {
                console.error('Error al guardar closedCases en Firebase:', error);
              } else {
                console.log('closedCases guardado en Firebase:', closedCases);
              }
            });

            var punto = allPuntos.find(p => p.caso === caso);
            if (!punto) {
              console.error('No se encontró el punto para el caso:', caso);
              return;
            }

            markerCluster.eachLayer(function(marker) {
              if (marker.getLatLng().lat === punto.lat && marker.getLatLng().lng === punto.lng) {
                marker.setIcon(L.AwesomeMarkers.icon({
                  markerColor: 'green',
                  icon: 'info-sign'
                }));
                marker._icon.classList.add('closed');
                console.log('Marcador cambiado a verde para el caso:', caso);
              }
            });

            if (tempMarker && tempMarker.getLatLng().lat === punto.lat && tempMarker.getLatLng().lng === punto.lng) {
              tempMarker.setIcon(L.AwesomeMarkers.icon({
                markerColor: 'green',
                icon: 'info-sign'
              }));
              tempMarker._icon.classList.add('closed');
            }
          };

          window.resetClosedCases = function() {
            if (!database) {
              console.error("Base de datos no inicializada. Espera a que Firebase se cargue.");
              return;
            }
            closedCases = {};
            database.ref('closedCases').set(closedCases, (error) => {
              if (error) {
                console.error('Error al restablecer closedCases en Firebase:', error);
              } else {
                console.log('closedCases restablecido en Firebase');
              }
            });
            filtrarPorPrioridad();
            console.log('Estado de casos cerrados restablecido');
          };

          window.mostrarFotos = function(caso) {
            console.log("Mostrando fotos para el caso: " + caso);
            console.log("Fotos disponibles: ", fotosPorCaso[caso]);
            var fotosPanel = document.getElementById('fotos-panel');
            var fotosContent = document.getElementById('fotos-content');
            var fotosHeaderLink = document.getElementById('fotos-header-link');
            var body = document.body;

            var fotos = fotosPorCaso[caso] ? fotosPorCaso[caso].images : [];
            var folderUrl = fotosPorCaso[caso] ? fotosPorCaso[caso].folder : '#';

            fotosHeaderLink.href = folderUrl;

            fotosPanel.style.display = 'flex';
            body.classList.add('fotos-panel-visible');

            fotosContent.innerHTML = '';

            if (fotos.length === 0) {
                console.log("No hay fotos para este caso.");
                fotosContent.innerHTML = '<p>No hay fotos</p>';
            } else {
                console.log("Generando HTML para las fotos...");
                fotos.forEach(function(foto) {
                    console.log("Procesando foto:", foto);
                    var fotoHtml = `<div class="foto-item"><img src="${foto}" alt="Foto" onclick="abrirFotoGrande('${foto}')"></div>`;
                    fotosContent.innerHTML += fotoHtml;
                });
                console.log("HTML de fotos generado.");
            }
          };

          window.openFotosDrive = function(event) {
            event.preventDefault();
            var fotosHeaderLink = document.getElementById('fotos-header-link');
            if (fotosHeaderLink.href !== '#') {
                window.open(fotosHeaderLink.href, '_blank');
            }
          };

          window.cerrarFotos = function() {
            var fotosPanel = document.getElementById('fotos-panel');
            if (fotosPanel.style.display === 'flex') {
              console.log("Cerrando panel de fotos...");
              var body = document.body;
              fotosPanel.style.display = 'none';
              body.classList.remove('fotos-panel-visible');
            }
          };

          window.abrirFotoGrande = function(fotoUrl) {
            console.log("Abriendo foto en grande:", fotoUrl);
            var viewer = document.getElementById('fotos-viewer');
            var viewerImg = document.getElementById('fotos-viewer-img');
            viewerImg.src = fotoUrl;
            viewer.style.display = 'flex';
          };

          window.cerrarFotoGrande = function() {
            console.log("Cerrando visor de fotos...");
            var viewer = document.getElementById('fotos-viewer');
            viewer.style.display = 'none';
          };

          function waitForMap(callback) {
            var attempts = 0;
            var maxAttempts = 100;

            function tryInit() {
              attempts++;
              map = window['map_{mapa.get_name()}'];
              if (map) {
                console.log('Mapa inicializado después de', attempts, 'intentos');
                map.eachLayer(function(layer) {
                  if (layer instanceof L.MarkerClusterGroup) {
                    markerCluster = layer;
                    console.log('MarkerCluster encontrado:', markerCluster);
                  }
                });
                callback();
                return;
              }

              var mapFound = false;
              for (var key in window) {
                if (key.startsWith('map_') && window[key] instanceof L.Map) {
                  console.log('Mapa encontrado en window con clave:', key);
                  mapFound = true;
                  map = window[key];
                  map.eachLayer(function(layer) {
                    if (layer instanceof L.MarkerClusterGroup) {
                      markerCluster = layer;
                      console.log('MarkerCluster encontrado:', markerCluster);
                    }
                  });
                  callback();
                  return;
                }
              }

              if (attempts < maxAttempts) {
                console.log('Intento', attempts, 'de', maxAttempts, '- Mapa no encontrado aún');
                setTimeout(tryInit, 200);
              } else {
                console.error('No se pudo inicializar el mapa después de', maxAttempts, 'intentos');
                var mapElement = document.querySelector('.leaflet-container');
                if (mapElement && mapElement._leaflet_map) {
                  map = mapElement._leaflet_map;
                  console.log('Mapa encontrado directamente en el DOM');
                  map.eachLayer(function(layer) {
                    if (layer instanceof L.MarkerClusterGroup) {
                      markerCluster = layer;
                      console.log('MarkerCluster encontrado:', markerCluster);
                    }
                  });
                  callback();
                } else {
                  console.error('No se pudo encontrar el mapa ni en window ni en el DOM');
                  document.getElementById('loading-overlay').style.display = 'none';
                }
              }
            }

            tryInit();
          }

          function processPendingActions() {
            pendingActions.forEach(function(action) {
              var lat = action.lat;
              var lng = action.lng;
              var popupContent = action.popupContent;

              console.log('Procesando acción pendiente - Centrando en:', lat, lng);

              map.setView([lat, lng], 15);

              if (tempMarker) {
                map.removeLayer(tempMarker);
                tempMarker = null;
              }

              tempMarker = L.marker([lat, lng]).addTo(map);
              tempMarker.bindPopup(popupContent).openPopup();
              currentPopup = tempMarker;

              console.log('Popup abierto en:', lat, lng);
            });
            pendingActions = [];
          }

          function toggleLista() {
            var panel = document.getElementById('pending-panel');
            var list = document.getElementById('pending-list');
            var arrow = document.getElementById('pending-arrow');
            if (!panel || !list || !arrow) {
              console.error('No se encontraron los elementos pending-panel, pending-list o pending-arrow');
              return;
            }
            isPendingListExpanded = !isPendingListExpanded;
            if (isPendingListExpanded) {
              panel.style.display = 'block';
              list.style.display = 'block';
              arrow.style.transform = 'rotate(90deg)';
              panel.classList.add('expanded');
            } else {
              panel.style.display = 'none';
              list.style.display = 'none';
              arrow.style.transform = 'rotate(0deg)';
              panel.classList.remove('expanded');
            }
            localStorage.setItem('pendingListExpanded', isPendingListExpanded);
            console.log('Lista "Direcciones Pendientes" toggled. Estado:', isPendingListExpanded);
          }

          function toggleFilters() {
            var filtersContent = document.getElementById('filters-content');
            var filtersArrow = document.getElementById('filters-arrow');
            var filtersPanel = document.getElementById('filters-panel');
            if (!filtersContent || !filtersArrow || !filtersPanel) {
              console.error('No se encontraron los elementos filters-content, filters-arrow o filters-panel');
              return;
            }
            isFiltersExpanded = !isFiltersExpanded;
            if (isFiltersExpanded) {
              filtersContent.style.display = 'block';
              filtersArrow.style.transform = 'rotate(90deg)';
              filtersPanel.classList.add('expanded');
            } else {
              filtersContent.style.display = 'none';
              filtersArrow.style.transform = 'rotate(0deg)';
              filtersPanel.classList.remove('expanded');
            }
            localStorage.setItem('filtersExpanded', isFiltersExpanded);
            console.log('Subpanel de filtros toggled. Estado:', isFiltersExpanded);
          }

          function toggleNoMapeadasLista() {
            var panel = document.getElementById('no-mapeadas-panel');
            var list = document.getElementById('no-mapeadas-list');
            var arrow = document.getElementById('no-mapeadas-arrow');
            if (!panel || !list || !arrow) {
              console.error('No se encontraron los elementos no-mapeadas-panel, no-mapeadas-list o no-mapeadas-arrow');
              return;
            }
            isNoMapeadasListExpanded = !isNoMapeadasListExpanded;
            if (isNoMapeadasListExpanded) {
              panel.style.display = 'block';
              list.style.display = 'block';
              arrow.style.transform = 'rotate(90deg)';
              panel.classList.add('expanded');
            } else {
              panel.style.display = 'none';
              list.style.display = 'none';
              arrow.style.transform = 'rotate(0deg)';
              panel.classList.remove('expanded');
            }
            localStorage.setItem('noMapeadasListExpanded', isNoMapeadasListExpanded);
            console.log('Lista "Direcciones No Mapeadas" toggled. Estado:', isNoMapeadasListExpanded);
          }

          function filtrarLista() {
            var direccionInput = document.getElementById('pending-search');
            var comunaFilter = document.getElementById('comuna-filter');
            var priorityFilter = document.getElementById('priority-filter');
            var list = document.getElementById('pending-list');
            var arrow = document.getElementById('pending-arrow');
            var panel = document.getElementById('pending-panel');

            if (!direccionInput || !comunaFilter || !priorityFilter || !list || !arrow || !panel) {
              console.error('No se encontraron los elementos de filtrado en filtrarLista');
              return;
            }

            var direccionFilter = direccionInput.value.toLowerCase();
            var comunaValue = comunaFilter.value;
            var priorityValue = priorityFilter.value;

            var anyFilter = direccionFilter.length > 0 || comunaValue !== 'all' || priorityValue !== 'all';
            if (anyFilter && !isPendingListExpanded) {
              isPendingListExpanded = true;
              panel.style.display = 'block';
              list.style.display = 'block';
              arrow.style.transform = 'rotate(90deg)';
              panel.classList.add('expanded');
              localStorage.setItem('pendingListExpanded', isPendingListExpanded);
            } else if (!anyFilter && isPendingListExpanded) {
              isPendingListExpanded = false;
              panel.style.display = 'none';
              list.style.display = 'none';
              arrow.style.transform = 'rotate(0deg)';
              panel.classList.remove('expanded');
              localStorage.setItem('pendingListExpanded', isPendingListExpanded);
            }

            var items = list.getElementsByTagName('li');
            for (var i = 0; i < items.length; i++) {
              var direccion = (items[i].textContent || items[i].innerText).toLowerCase();
              var comuna = items[i].getAttribute('data-comuna').toLowerCase();

              var matchesDireccion = direccion.includes(direccionFilter);
              var matchesComuna = comunaValue === 'all' || comuna === comunaValue.toLowerCase();

              if (matchesDireccion && matchesComuna) {
                items[i].style.display = '';
                items[i].classList.add('highlight');
              } else {
                items[i].style.display = 'none';
                items[i].classList.remove('highlight');
              }
            }
            console.log('Filtrando lista "Direcciones Pendientes". Filtros:', {direccion: direccionFilter, comuna: comunaValue, prioridad: priorityValue});
          }

          function filtrarNoMapeadasLista() {
            var input = document.getElementById('no-mapeadas-search');
            var filter = input.value.toLowerCase();
            var list = document.getElementById('no-mapeadas-list');
            var arrow = document.getElementById('no-mapeadas-arrow');
            var panel = document.getElementById('no-mapeadas-panel');
            if (!input || !list || !arrow || !panel) {
              console.error('No se encontraron los elementos no-mapeadas-search, no-mapeadas-list, no-mapeadas-arrow o no-mapeadas-panel en filtrarNoMapeadasLista');
              return;
            }

            if (filter.length > 0 && !isNoMapeadasListExpanded) {
              isNoMapeadasListExpanded = true;
              panel.style.display = 'block';
              list.style.display = 'block';
              arrow.style.transform = 'rotate(90deg)';
              panel.classList.add('expanded');
              localStorage.setItem('noMapeadasListExpanded', isNoMapeadasListExpanded);
            } else if (filter.length === 0 && isNoMapeadasListExpanded) {
              isNoMapeadasListExpanded = false;
              panel.style.display = 'none';
              list.style.display = 'none';
              arrow.style.transform = 'rotate(0deg)';
              panel.classList.remove('expanded');
              localStorage.setItem('noMapeadasListExpanded', isNoMapeadasListExpanded);
            }

            var items = list.getElementsByTagName('li');
            for (var i = 0; i < items.length; i++) {
              var txtValue = items[i].textContent || items[i].innerText;
              if (txtValue.toLowerCase().includes(filter)) {
                items[i].style.display = '';
                items[i].classList.add('highlight');
              } else {
                items[i].style.display = 'none';
                items[i].classList.remove('highlight');
              }
            }
            console.log('Filtrando lista "Direcciones No Mapeadas". Filtro:', filter);
          }

          function filtrarPorPrioridad() {
            var priorityFilter = document.getElementById('priority-filter').value;
            markerCluster.clearLayers();
            allPuntos.forEach(function(punto) {
              if (priorityFilter === 'all' || punto.color === priorityFilter) {
                var markerColor = closedCases[punto.caso] ? 'green' : punto.color;
                var marker = L.marker([punto.lat, punto.lng], {
                  icon: L.AwesomeMarkers.icon({
                    markerColor: markerColor,
                    icon: 'info-sign'
                  })
                }).bindPopup(punto.popup_content);
                markerCluster.addLayer(marker);
              }
            });
            localStorage.setItem('priorityFilter', priorityFilter);
            filtrarLista();
            console.log('Filtrando por prioridad:', priorityFilter);
          }

          function filtrarPorComuna() {
            var comunaFilter = document.getElementById('comuna-filter').value;
            localStorage.setItem('comunaFilter', comunaFilter);
            filtrarLista();
            console.log('Filtrando por comuna:', comunaFilter);
          }

          function centrarEn(element) {
            var lat = parseFloat(element.getAttribute('data-lat'));
            var lng = parseFloat(element.getAttribute('data-lng'));
            var popupContent = element.getAttribute('data-popup');

            if (!map) {
              console.log('Mapa no inicializado aún, añadiendo acción a la cola');
              pendingActions.push({ lat: lat, lng: lng, popupContent: popupContent });
              return;
            }

            console.log('Centrando en:', lat, lng);

            map.setView([lat, lng], 15);

            closeCurrentPopup();

            tempMarker = L.marker([lat, lng]).addTo(map);
            tempMarker.bindPopup(popupContent).openPopup();
            currentPopup = tempMarker;

            if (selectedMarker) {
              selectedMarker._icon.classList.remove('selected');
            }
            markerCluster.eachLayer(function(marker) {
              if (marker.getLatLng().lat === lat && marker.getLatLng().lng === lng) {
                marker._icon.classList.add('selected');
                selectedMarker = marker;
              }
            });

            console.log('Popup abierto en:', lat, lng);
          }

          function locateMe() {
            if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(function(position) {
                var lat = position.coords.latitude;
                var lng = position.coords.longitude;
                map.setView([lat, lng], 15);
                L.marker([lat, lng], {
                  icon: L.AwesomeMarkers.icon({
                    markerColor: 'blue',
                    icon: 'user'
                  })
                }).addTo(map).bindPopup('Tu ubicación').openPopup();
                console.log('Centrado en ubicación del usuario:', lat, lng);
              }, function(error) {
                console.error('Error al obtener la ubicación:', error);
                alert('No se pudo obtener tu ubicación. Asegúrate de permitir el acceso a la geolocalización.');
              });
            } else {
              console.error('Geolocalización no soportada por el navegador');
              alert('Tu navegador no soporta geolocalización.');
            }
          }

          function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            var isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            console.log('Modo oscuro:', isDarkMode);
          }

          function exportToExcel() {
            var excelUrl = 'https://raw.githubusercontent.com/riv1matias/mapa_op_cables/main/mapa_interactivo_Optical_Power.xlsx';
            var nombreArchivo = 'mapa_interactivo_Optical_Power.xlsx';
            console.log('Intentando descargar Excel desde:', excelUrl);

            // Verificar si el archivo existe en el servidor
            fetch(excelUrl, { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        // Si el archivo existe, proceder con la descarga
                        var link = document.createElement('a');
                        link.setAttribute('href', excelUrl);
                        link.setAttribute('download', nombreArchivo);
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        console.log('Descarga iniciada para:', nombreArchivo);
                    } else {
                        console.error('Archivo Excel no encontrado en el servidor:', excelUrl);
                        alert('El archivo Excel no está disponible en el servidor. Por favor, contacta al administrador.');
                    }
                })
                .catch(error => {
                    console.error('Error al verificar el archivo Excel:', error);
                    alert('Error al intentar descargar el archivo Excel. Verifica tu conexión o contacta al administrador.');
                });
          }

          function toggleTableView() {
            var tablePanel = document.getElementById('table-panel');
            var tableRows = document.getElementById('table-rows');
            if (tablePanel.style.display === 'flex') {
              tablePanel.style.display = 'none';
              return;
            }

            tableRows.innerHTML = '';
            allPuntos.forEach(function(punto) {
              var row = document.createElement('tr');
              row.setAttribute('data-lat', punto.lat);
              row.setAttribute('data-lng', punto.lng);
              row.setAttribute('data-popup', punto.popup_content);
              row.innerHTML = `
                <td>${punto.direccion}</td>
                <td>${punto.comuna}</td>
                <td>${punto.caso}</td>
                <td>${punto.ot}</td>
              `;
              tableRows.appendChild(row);
            });

            tablePanel.style.display = 'flex';
          }

          function toggleRoute() {
            if (!map) {
              console.error('Mapa no inicializado aún');
              return;
            }

            isRouteVisible = !isRouteVisible;
            if (isRouteVisible) {
              if (!routeLayer) {
                routeLayer = L.polyline(recorrido, {
                  color: '#ff0000',
                  weight: 4,
                  opacity: 0.7
                }).addTo(map);
              } else {
                map.addLayer(routeLayer);
              }
              if (recorrido.length > 0) {
                var bounds = L.latLngBounds(recorrido);
                map.fitBounds(bounds, { padding: [50, 50] });
              }
              console.log('Recorrido mostrado');
            } else {
              if (routeLayer) {
                map.removeLayer(routeLayer);
              }
              console.log('Recorrido ocultado');
            }
            localStorage.setItem('routeVisible', isRouteVisible);
          }

          function limpiarPopupsAntiguos() {
            console.log("Limpiando popups antiguos del DOM...");
            var popups = document.querySelectorAll('.leaflet-popup');
            popups.forEach(function(popup) {
              console.log("Eliminando popup del DOM:", popup);
              popup.remove();
            });
          }

          function closeCurrentPopup() {
            if (isClosingPopup) {
              console.log("closeCurrentPopup ya está en ejecución, evitando recursión.");
              return;
            }
            isClosingPopup = true;
            try {
              if (currentPopup) {
                console.log("Cerrando popup actual...");
                map.closePopup();
                currentPopup = null;
              }
              if (tempMarker) {
                console.log("Eliminando marcador temporal...");
                map.removeLayer(tempMarker);
                tempMarker = null;
              }
              if (selectedMarker) {
                selectedMarker._icon.classList.remove('selected');
                selectedMarker = null;
              }
              limpiarPopupsAntiguos();
              window.cerrarFotos();
            } finally {
              isClosingPopup = false;
            }
          }

          document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM cargado, inicializando eventos...");

            isPendingListExpanded = localStorage.getItem('pendingListExpanded') === 'true';
            isNoMapeadasListExpanded = localStorage.getItem('noMapeadasListExpanded') === 'true';
            isFiltersExpanded = localStorage.getItem('filtersExpanded') === 'true';
            var savedPriorityFilter = localStorage.getItem('priorityFilter') || 'all';
            var savedComunaFilter = localStorage.getItem('comunaFilter') || 'all';
            var savedDarkMode = localStorage.getItem('darkMode') === 'true';
            isRouteVisible = localStorage.getItem('routeVisible') === 'true';

            var pendingList = document.getElementById('pending-list');
            var pendingArrow = document.getElementById('pending-arrow');
            var pendingPanel = document.getElementById('pending-panel');
            var filtersContent = document.getElementById('filters-content');
            var filtersArrow = document.getElementById('filters-arrow');
            var filtersPanel = document.getElementById('filters-panel');
            var noMapeadasList = document.getElementById('no-mapeadas-list');
            var noMapeadasArrow = document.getElementById('no-mapeadas-arrow');
            var noMapeadasPanel = document.getElementById('no-mapeadas-panel');
            var priorityFilter = document.getElementById('priority-filter');
            var comunaFilter = document.getElementById('comuna-filter');

            if (isPendingListExpanded) {
              pendingPanel.style.display = 'block';
              pendingList.style.display = 'block';
              pendingArrow.style.transform = 'rotate(90deg)';
              pendingPanel.classList.add('expanded');
            }
            if (isFiltersExpanded) {
              filtersContent.style.display = 'block';
              filtersArrow.style.transform = 'rotate(90deg)';
              filtersPanel.classList.add('expanded');
            }
            if (isNoMapeadasListExpanded) {
              noMapeadasPanel.style.display = 'block';
              noMapeadasList.style.display = 'block';
              noMapeadasArrow.style.transform = 'rotate(90deg)';
              noMapeadasPanel.classList.add('expanded');
            }
            if (savedDarkMode) {
              document.body.classList.add('dark-mode');
            }
            priorityFilter.value = savedPriorityFilter;
            comunaFilter.value = savedComunaFilter;

            waitForMap(function() {
              console.log("Mapa inicializado, registrando eventos para marcadores...");
              if (markerCluster) {
                console.log("Registrando eventos para marcadores dentro de MarkerCluster...");
                markerCluster.eachLayer(function(marker) {
                  marker.on('click', function(e) {
                    console.log("Clic en marcador del mapa en posición:", e.latlng);
                    closeCurrentPopup();
                    var popupContent = marker.getPopup().getContent();
                    if (typeof popupContent !== 'string') {
                      popupContent = popupContent.outerHTML;
                    }
                    var latlng = e.latlng;
                    tempMarker = L.marker(latlng).addTo(map);
                    tempMarker.bindPopup(popupContent).openPopup();
                    currentPopup = tempMarker;
                    marker._icon.classList.add('selected');
                    if (selectedMarker) {
                      selectedMarker._icon.classList.remove('selected');
                    }
                    selectedMarker = marker;
                  });
                });
              } else {
                console.log("MarkerCluster no encontrado.");
              }

              map.on('popupclose', function() {
                console.log("Popup cerrado en el mapa.");
                closeCurrentPopup();
              });

              filtrarPorPrioridad();
              filtrarPorComuna();
              processPendingActions();

              if (isRouteVisible) {
                toggleRoute();
              }
            });

            var filtersHeader = document.getElementById('filters-header');
            var pendingSearch = document.getElementById('pending-search');
            var pendingList = document.getElementById('pending-list');
            var noMapeadasSearch = document.getElementById('no-mapeadas-search');
            var noMapeadasList = document.getElementById('no-mapeadas-list');
            var fotosClose = document.getElementById('fotos-close');
            var fotosViewerClose = document.getElementById('fotos-viewer-close');
            var fotosPanel = document.getElementById('fotos-panel');
            var locateMeBtn = document.getElementById('locate-me-btn');
            var toggleThemeBtn = document.getElementById('toggle-theme-btn');
            var exportExcelBtn = document.getElementById('export-excel-btn');
            var toggleTableBtn = document.getElementById('toggle-table-btn');
            var resetClosedBtn = document.getElementById('reset-closed-btn');
            var toggleRouteBtn = document.getElementById('toggle-route-btn');
            var togglePendingBtn = document.getElementById('toggle-pending-btn');
            var toggleNoMapeadasBtn = document.getElementById('toggle-no-mapeadas-btn');
            var tableClose = document.getElementById('table-close');
            var tableRows = document.getElementById('table-rows');

            if (!filtersHeader || !pendingSearch || !pendingList) {
              console.error('No se encontraron los elementos de "Direcciones Pendientes"');
              return;
            }
            if (!noMapeadasSearch || !noMapeadasList) {
              console.error('No se encontraron los elementos de "Direcciones No Mapeadas"');
              return;
            }
            if (!fotosClose || !fotosViewerClose || !fotosPanel) {
              console.error('No se encontraron los elementos del panel de fotos');
              return;
            }
            if (!locateMeBtn || !toggleThemeBtn || !exportExcelBtn || !toggleTableBtn || !resetClosedBtn || !toggleRouteBtn || !togglePendingBtn || !toggleNoMapeadasBtn || !tableClose || !tableRows) {
              console.error('No se encontraron los botones de control');
              return;
            }

            filtersHeader.addEventListener('click', toggleFilters);
            filtersHeader.addEventListener('keypress', function(e) {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                toggleFilters();
              }
            });

            pendingSearch.addEventListener('input', filtrarLista);
            pendingSearch.addEventListener('keypress', function(e) {
              if (e.key === 'Enter') {
                filtrarLista();
              }
            });

            var pendingItems = pendingList.getElementsByTagName('li');
            for (var i = 0; i < pendingItems.length; i++) {
              pendingItems[i].addEventListener('click', function() {
                centrarEn(this);
              });
            }

            noMapeadasSearch.addEventListener('input', filtrarNoMapeadasLista);
            noMapeadasSearch.addEventListener('keypress', function(e) {
              if (e.key === 'Enter') {
                filtrarNoMapeadasLista();
              }
            });

            fotosClose.addEventListener('click', window.cerrarFotos);
            fotosViewerClose.addEventListener('click', window.cerrarFotoGrande);

            let touchStartX = 0;
            let touchEndX = 0;

            fotosPanel.addEventListener('touchstart', function(e) {
              touchStartX = e.changedTouches[0].screenX;
            });

            fotosPanel.addEventListener('touchend', function(e) {
              touchEndX = e.changedTouches[0].screenX;
              if (touchStartX - touchEndX < -50) {
                window.cerrarFotos();
              }
            });

            locateMeBtn.addEventListener('click', locateMe);
            toggleThemeBtn.addEventListener('click', toggleTheme);
            exportExcelBtn.addEventListener('click', exportToExcel);
            toggleTableBtn.addEventListener('click', toggleTableView);
            resetClosedBtn.addEventListener('click', window.resetClosedCases);
            toggleRouteBtn.addEventListener('click', toggleRoute);
            togglePendingBtn.addEventListener('click', toggleLista);
            toggleNoMapeadasBtn.addEventListener('click', toggleNoMapeadasLista);
            tableClose.addEventListener('click', function() {
              document.getElementById('table-panel').style.display = 'none';
            });

            tableRows.addEventListener('click', function(e) {
              var target = e.target.closest('tr');
              if (target) {
                centrarEn(target);
              }
            });

            console.log('Eventos inicializados correctamente');
          });
        </script>
        
    
            <div class="folium-map" id="map_668f89319b27fe6ccb41764899ce32f6" ></div>
        
    
        <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

        <style>
        #loading-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(255, 255, 255, 0.8);
          z-index: 2000;
          display: flex;
          justify-content: center;
          align-items: center;
        }
        #loading-spinner {
          border: 4px solid #f3f3f3;
          border-top: 4px solid #007bff;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          animation: spin 1s linear infinite;
        }
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        .dark-mode .leaflet-container {
          filter: invert(90%) hue-rotate(180deg);
        }
        .dark-mode #pending-panel, .dark-mode #no-mapeadas-panel, .dark-mode #fotos-panel, .dark-mode #table-panel, .dark-mode #filters-panel {
          background: #333;
          color: #fff;
          border-color: #555;
        }
        .dark-mode #pending-panel.expanded, .dark-mode #filters-panel.expanded {
          border-color: #66b0ff;
        }
        .dark-mode #no-mapeadas-panel.expanded {
          border-color: #ff6666;
        }
        .dark-mode #pending-list li:hover, .dark-mode #no-mapeadas-list li:hover, .dark-mode #table-body tr:hover {
          background: #555;
        }
        .dark-mode #pending-list li.highlight, .dark-mode #no-mapeadas-list li.highlight {
          background: #444;
        }
        .dark-mode #pending-search, .dark-mode #no-mapeadas-search, .dark-mode #comuna-filter, .dark-mode #priority-filter {
          background: #444;
          color: #fff;
          border-color: #666;
        }
        .dark-mode #fotos-header {
          border-bottom: 1px solid #555;
        }
        .dark-mode #fotos-close, .dark-mode #fotos-viewer-close {
          color: #fff;
        }
        .dark-mode #table-header, .dark-mode #filters-header {
          background: #444;
        }
        #pending-panel {
          position: absolute;
          top: 10px;
          right: 10px;
          z-index: 1000;
          background: white;
          padding: 8px;
          border: 1px solid gray;
          max-height: 400px;
          overflow: auto;
          font: 12px/1.4 Arial;
          width: 340px;
          border-radius: 4px;
          transition: border-color 0.3s;
          display: none; /* Oculto por defecto */
        }
        #pending-panel.expanded {
          border-color: #007bff;
        }
        #pending-header {
          font-weight: bold;
          display: flex;
          align-items: center;
          user-select: none;
        }
        #pending-list {
          padding-left: 16px;
          list-style: none;
        }
        #pending-list li {
          cursor: pointer;
          margin: 4px 0;
          padding: 2px;
          transition: background 0.2s;
        }
        #pending-list li:hover {
          background: #ccc;
        }
        #pending-list li.highlight {
          background: #e6f3ff;
        }
        #pending-search, #comuna-filter, #priority-filter {
          width: 100%;
          margin: 4px 0;
          padding: 4px;
          font-size: 12px;
          box-sizing: border-box;
          border: 1px solid #ccc;
          border-radius: 3px;
        }
        #pending-arrow {
          transition: transform 0.3s;
          margin-right: 5px;
        }
        #filters-panel {
          margin-top: 8px;
          border: 1px solid #ccc;
          border-radius: 4px;
          padding: 4px;
          transition: border-color 0.3s;
        }
        #filters-panel.expanded {
          border-color: #007bff;
        }
        #filters-header {
          font-weight: bold;
          display: flex;
          align-items: center;
          user-select: none;
          background: #f0f0f0;
          padding: 4px;
          border-radius: 3px;
        }
        #filters-content {
          display: none;
          padding: 4px;
        }
        #filters-arrow {
          transition: transform 0.3s;
          margin-right: 5px;
        }
        #no-mapeadas-panel {
          position: absolute;
          bottom: 10px;
          right: 10px;
          z-index: 1000;
          background: white;
          padding: 8px;
          border: 1px solid red;
          max-height: 400px;
          overflow: auto;
          font: 12px/1.4 Arial;
          width: 340px;
          border-radius: 4px;
          transition: border-color 0.3s;
          display: none; /* Oculto por defecto */
        }
        #no-mapeadas-panel.expanded {
          border-color: #ff4d4d;
        }
        #no-mapeadas-header {
          font-weight: bold;
          display: flex;
          align-items: center;
          user-select: none;
        }
        #no-mapeadas-list {
          padding-left: 16px;
          list-style: none;
        }
        #no-mapeadas-list li {
          margin: 4px 0;
          padding: 2px;
          transition: background 0.2s;
        }
        #no-mapeadas-list li:hover {
          background: #ccc;
        }
        #no-mapeadas-list li.highlight {
          background: #e6f3ff;
        }
        #no-mapeadas-search {
          width: 100%;
          margin: 4px 0;
          padding: 4px;
          font-size: 12px;
          box-sizing: border-box;
          border: 1px solid #ccc;
          border-radius: 3px;
        }
        #no-mapeadas-arrow {
          transition: transform 0.3s;
          margin-right: 5px;
        }
        #fotos-panel {
          position: fixed;
          top: 0;
          right: 0;
          width: 30%;
          height: 100%;
          background: white;
          border-left: 1px solid #ccc;
          z-index: 1000;
          display: none;
          flex-direction: column;
          overflow: hidden;
          touch-action: pan-y;
        }
        #fotos-header {
          padding: 10px;
          font: bold 14px Arial;
          border-bottom: 1px solid #ccc;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }
        #fotos-content {
          flex: 1;
          overflow-y: auto;
          padding: 10px;
          font: 12px Arial;
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
        }
        .foto-item {
          flex: 1 1 100%;
          position: relative;
        }
        .foto-item img {
          width: 100%;
          height: auto;
          max-height: 200px;
          object-fit: contain;
          cursor: pointer;
          border: 1px solid #ddd;
          border-radius: 4px;
        }
        #fotos-close {
          cursor: pointer;
          font-size: 16px;
          color: #333;
        }
        #fotos-viewer {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.8);
          z-index: 2000;
          display: none;
          justify-content: center;
          align-items: center;
        }
        #fotos-viewer img {
          max-width: 90%;
          max-height: 90%;
          object-fit: contain;
        }
        #fotos-viewer-close {
          position: absolute;
          top: 20px;
          right: 20px;
          color: white;
          font-size: 24px;
          cursor: pointer;
        }
        .leaflet-container {
          width: 100%;
          transition: width 0.3s;
        }
        .fotos-panel-visible .leaflet-container {
          width: 70%;
        }
        .leaflet-marker-icon.selected {
          transform: scale(1.2);
          transition: transform 0.2s;
        }
        .leaflet-marker-icon.closed {
          filter: hue-rotate(90deg);
        }
        #locate-me-btn, #toggle-theme-btn, #export-excel-btn, #toggle-table-btn, #toggle-comparison-btn, #reset-closed-btn, #toggle-route-btn, #toggle-pending-btn, #toggle-no-mapeadas-btn {
          position: fixed;
          z-index: 1000;
          background: #007bff;
          color: white;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          font-size: 18px;
          transition: background 0.3s;
        }
        #locate-me-btn:hover, #toggle-theme-btn:hover, #export-excel-btn:hover, #toggle-table-btn:hover, #toggle-comparison-btn:hover, #reset-closed-btn:hover, #toggle-route-btn:hover, #toggle-pending-btn:hover, #toggle-no-mapeadas-btn:hover {
          background: #0056b3;
        }
        #locate-me-btn {
          bottom: 20px;
          left: 20px;
        }
        #toggle-theme-btn {
          bottom: 70px;
          left: 20px;
        }
        #export-excel-btn {
          bottom: 120px;
          left: 20px;
        }
        #toggle-table-btn {
          bottom: 170px;
          left: 20px;
        }
        #toggle-comparison-btn {
          top: 10px;
          right: 360px;
          display: none;
        }
        #reset-closed-btn {
          bottom: 220px;
          left: 20px;
        }
        #toggle-route-btn {
          bottom: 270px;
          left: 20px;
        }
        #toggle-pending-btn {
          position: fixed;
          z-index: 1000;
          background: #007bff;
          color: white;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          font-size: 18px;
          transition: background 0.3s;
          top: 40px;
          right: 10px; /* Ajustado para alinearse con el panel */
        }
        #toggle-no-mapeadas-btn {
          position: fixed;
          z-index: 1000;
          background: #007bff;
          color: white;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          font-size: 18px;
          transition: background 0.3s;
          bottom: 10px;
          right: 10px; /* Ajustado para alinearse con el panel */
        }
        #table-panel {
          position: fixed;
          top: 50px;
          left: 50%;
          transform: translateX(-50%);
          width: 90%;
          max-height: 80vh;
          background: white;
          border: 1px solid #fff;
          z-index: 1000;
          display: none;
          flex-direction: column;
          overflow: hidden;
          border-radius: 4px;
        }
        #table-header {
          background: #f0f0;
          padding: 8px;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }
        #table-body {
          flex: 1;
          overflow-y: auto;
          font: 12px Arial;
        }

        #table-body table {
          width: 100%;
          border-collapse: collapse;
        }
        #table-body th, #table-body td {
          padding: 8px;
          border-bottom: 1px solid #ddd;
          text-align: left;
        }
        #table-body th {
          background: #e0e0e0;
          position: sticky;
          top: 0;
          z-index: 10;
        }

        #table-body tr {
          cursor: pointer;
          transition: background 0.2s;
        }

        #table-body tr:hover tr {
          background: #f0f0f0;
        }

        @media (max-width: 768px) {
          #pending-panel, #no-mapeadas-panel {
            width: 90vw;
            padding: 8px;
          }
          #fotos-panel {
            width: 100vw;
          }
          .fotos-panel-visible .leaflet-container {
            width: 100%;
          }
          .foto-foto-item {
            padding: 4px;
          }
          #fotos-viewer img {
            max-width: 95%;
            max-height: 85%;
          }
          #table-panel {
            width: 95%;
            padding: 4px;
          }

          #table-body th, #table-head th td {
            padding: 6px;
          }

          #toggle-pending-btn {
            top: 40px;
            right: 10px;
          }

          #toggle-no-mapeadas-btn {
            bottom: 10px;
            right: 10px;
          }
        }
      </style>
        <div id="loading-overlay">
          <div id="loading-spinner"></div>
        </div>
        <div id="pending-panel">
          <div id="pending-header">
            <svg id="pending-arrow" width="14" height="14" viewBox="0 0 24 24">
              <path fill="currentColor" d="M10 17l5-5-5-5v10z"/>
            </svg> Direcciones Pendientes <span>(7)</span>
          </div>
          <div id="filters-panel">
            <div id="filters-header">
              <svg id="filters-arrow" width="14" height="14" viewBox="0 0 24 24">
                <path fill="currentColor" d="M10 17l5-5-5-5v10z"/>
              </svg> Filtros
            </div>
            <div id="filters-content">
              <select id="priority-filter" onchange="filtrarPorPrioridad()">
                <option value="all">Todas las Prioridades</option>
                <option value="blue">Prioritarios</option>
                <option value="lightblue">Preventivo sin prioridad</option>
              </select>
              <select id="comuna-filter" onchange="filtrarPorComuna()">
                <option value='all'>Todas las Comunas</option><option value='6'>6</option><option value='10'>10</option><option value='12'>12</option><option value='14'>14</option>
              </select>
              <input id="pending-search" placeholder="Buscar Dirección..." type="text">
            </div>
          </div>
          <ul id="pending-list"><li data-lat="-34.588033" data-lng="-58.417181" data-popup="&lt;div style=&#x27;width: 200px; font: 12px Arial;&#x27; data-caso=&quot;5862&quot; data-comuna=&quot;14&quot;&gt;             &lt;b&gt;Dirección:&lt;/b&gt; CHARCAS 3715&lt;br&gt;             &lt;b&gt;Comuna:&lt;/b&gt; 14&lt;br&gt;             &lt;b&gt;OT:&lt;/b&gt; 806976061&lt;br&gt;             &lt;b&gt;Observaciones:&lt;/b&gt;&lt;br&gt;Cable en panza Cable cortado&lt;br&gt;             &lt;hr style=&quot;margin: 3px 0;&quot;&gt;             &lt;b&gt;Operación:&lt;/b&gt; Palermo&lt;br&gt;             &lt;b&gt;Zona:&lt;/b&gt; Capital Sur&lt;br&gt;                          &lt;hr style=&quot;margin: 3px 0;&quot;&gt;             &lt;b&gt;Caso:&lt;/b&gt; 5862&lt;br&gt;             &lt;br&gt;&lt;b&gt;&lt;a href=&quot;#&quot; onclick=&quot;mostrarFotos(&#x27;5862&#x27;); return false;&quot; style=&quot;font-size: 14px;&quot;&gt;Ver Fotos&lt;/a&gt;&lt;/b&gt;&lt;br&gt;             &lt;b&gt;Ver en Google Maps:&lt;/b&gt; &lt;a href=&quot;https://www.google.com/maps?q=-34.588033,-58.417181&quot; target=&quot;_blank&quot;&gt;Abrir&lt;/a&gt;&lt;br&gt;             &lt;br&gt;&lt;b&gt;&lt;a href=&quot;https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform&quot; target=&quot;_blank&quot; onclick=&quot;window.cerrarReclamo(&#x27;5862&#x27;);&quot; style=&quot;font-size: 14px;&quot;&gt;CERRAR RECLAMO&lt;/a&gt;&lt;/b&gt;         &lt;/div&gt;" data-comuna="14" data-caso="5862" data-ot="806976061">CHARCAS 3715</li>
<li data-lat="-34.579243" data-lng="-58.512533" data-popup="&lt;div style=&#x27;width: 200px; font: 12px Arial;&#x27; data-caso=&quot;5894&quot; data-comuna=&quot;12&quot;&gt;             &lt;b&gt;Dirección:&lt;/b&gt; ALBARELLOS AV. 3100&lt;br&gt;             &lt;b&gt;Comuna:&lt;/b&gt; 12&lt;br&gt;             &lt;b&gt;OT:&lt;/b&gt; 807045500&lt;br&gt;             &lt;b&gt;Observaciones:&lt;/b&gt;&lt;br&gt;No coinciden las fotos cargadas en el form con el reclamo original&lt;br&gt;             &lt;hr style=&quot;margin: 3px 0;&quot;&gt;             &lt;b&gt;Operación:&lt;/b&gt; Paternal&lt;br&gt;             &lt;b&gt;Zona:&lt;/b&gt; Capital Norte&lt;br&gt;                          &lt;hr style=&quot;margin: 3px 0;&quot;&gt;             &lt;b&gt;Caso:&lt;/b&gt; 5894&lt;br&gt;             &lt;br&gt;&lt;b&gt;&lt;a href=&quot;#&quot; onclick=&quot;mostrarFotos(&#x27;5894&#x27;); return false;&quot; style=&quot;font-size: 14px;&quot;&gt;Ver Fotos&lt;/a&gt;&lt;/b&gt;&lt;br&gt;             &lt;b&gt;Ver en Google Maps:&lt;/b&gt; &lt;a href=&quot;https://www.google.com/maps?q=-34.579243,-58.512533&quot; target=&quot;_blank&quot;&gt;Abrir&lt;/a&gt;&lt;br&gt;             &lt;br&gt;&lt;b&gt;&lt;a href=&quot;https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform&quot; target=&quot;_blank&quot; onclick=&quot;window.cerrarReclamo(&#x27;5894&#x27;);&quot; style=&quot;font-size: 14px;&quot;&gt;CERRAR RECLAMO&lt;/a&gt;&lt;/b&gt;         &lt;/div&gt;" data-comuna="12" data-caso="5894" data-ot="807045500">ALBARELLOS AV. 3100</li>
<li data-lat="-34.580805" data-lng="-58.431302" data-popup="&lt;div style=&#x27;width: 200px; font: 12px Arial;&#x27; data-caso=&quot;4238&quot; data-comuna=&quot;14&quot;&gt;             &lt;b&gt;Dirección:&lt;/b&gt; GUATEMALA 5527&lt;br&gt;             &lt;b&gt;Comuna:&lt;/b&gt; 14&lt;br&gt;             &lt;b&gt;OT:&lt;/b&gt; 807130137&lt;br&gt;             &lt;b&gt;Observaciones:&lt;/b&gt;&lt;br&gt;Las fotos que cargaron en el form no coinciden con las originales&lt;br&gt;             &lt;hr style=&quot;margin: 3px 0;&quot;&gt;             &lt;b&gt;Operación:&lt;/b&gt; Palermo&lt;br&gt;             &lt;b&gt;Zona:&lt;/b&gt; Capital Sur&lt;br&gt;                          &lt;hr style=&quot;margin: 3px 0;&quot;&gt;             &lt;b&gt;Caso:&lt;/b&gt; 4238&lt;br&gt;             &lt;br&gt;&lt;b&gt;&lt;a href=&quot;#&quot; onclick=&quot;mostrarFotos(&#x27;4238&#x27;); return false;&quot; style=&quot;font-size: 14px;&quot;&gt;Ver Fotos&lt;/a&gt;&lt;/b&gt;&lt;br&gt;             &lt;b&gt;Ver en Google Maps:&lt;/b&gt; &lt;a href=&quot;https://www.google.com/maps?q=-34.580805,-58.431302&quot; target=&quot;_blank&quot;&gt;Abrir&lt;/a&gt;&lt;br&gt;             &lt;br&gt;&lt;b&gt;&lt;a href=&quot;https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform&quot; target=&quot;_blank&quot; onclick=&quot;window.cerrarReclamo(&#x27;4238&#x27;);&quot; style=&quot;font-size: 14px;&quot;&gt;CERRAR RECLAMO&lt;/a&gt;&lt;/b&gt;         &lt;/div&gt;" data-comuna="14" data-caso="4238" data-ot="807130137">GUATEMALA 5527</li>
<li data-lat="-34.562841" data-lng="-58.440291" data-popup="&lt;div style=&#x27;width: 200px; font: 12px Arial;&#x27; data-caso=&quot;6262&quot; data-comuna=&quot;14&quot;&gt;             &lt;b&gt;Dirección:&lt;/b&gt; MIGUELETES 1330&lt;br&gt;             &lt;b&gt;Comuna:&lt;/b&gt; 14&lt;br&gt;             &lt;b&gt;OT:&lt;/b&gt; 807789707&lt;br&gt;             &lt;b&gt;Observaciones:&lt;/b&gt;&lt;br&gt;Cables en panza&lt;br&gt;             &lt;hr style=&quot;margin: 3px 0;&quot;&gt;             &lt;b&gt;Operación:&lt;/b&gt; Colegiales&lt;br&gt;             &lt;b&gt;Zona:&lt;/b&gt; Capital Norte&lt;br&gt;                          &lt;hr style=&quot;margin: 3px 0;&quot;&gt;             &lt;b&gt;Caso:&lt;/b&gt; 6262&lt;br&gt;             &lt;br&gt;&lt;b&gt;&lt;a href=&quot;#&quot; onclick=&quot;mostrarFotos(&#x27;6262&#x27;); return false;&quot; style=&quot;font-size: 14px;&quot;&gt;Ver Fotos&lt;/a&gt;&lt;/b&gt;&lt;br&gt;             &lt;b&gt;Ver en Google Maps:&lt;/b&gt; &lt;a href=&quot;https://www.google.com/maps?q=-34.562841,-58.440291&quot; target=&quot;_blank&quot;&gt;Abrir&lt;/a&gt;&lt;br&gt;             &lt;br&gt;&lt;b&gt;&lt;a href=&quot;https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform&quot; target=&quot;_blank&quot; onclick=&quot;window.cerrarReclamo(&#x27;6262&#x27;);&quot; style=&quot;font-size: 14px;&quot;&gt;CERRAR RECLAMO&lt;/a&gt;&lt;/b&gt;         &lt;/div&gt;" data-comuna="14" data-caso="6262" data-ot="807789707">MIGUELETES 1330</li>
<li data-lat="-34.62289" data-lng="-58.443538" data-popup="&lt;div style=&#x27;width: 248px; font: 12px Arial;&#x27; data-caso=&quot;6557&quot; data-comuna=&quot;6&quot;&gt;             &lt;b&gt;Dirección:&lt;/b&gt; ALBERDI, JUAN BAUTISTA AV. 1091&lt;br&gt;             &lt;b&gt;Comuna:&lt;/b&gt; 6&lt;br&gt;             &lt;b&gt;OT:&lt;/b&gt; Pedido a ADM&lt;br&gt;             &lt;b&gt;Observaciones:&lt;/b&gt;&lt;br&gt;Verificar si la linga panseada es nuestra y ver con pablo como resolverlo&lt;br&gt;             &lt;hr style=&quot;margin: 3px 0;&quot;&gt;             &lt;b&gt;Operación:&lt;/b&gt; Boedo&lt;br&gt;             &lt;b&gt;Zona:&lt;/b&gt; Capital Sur&lt;br&gt;                          &lt;hr style=&quot;margin: 3px 0;&quot;&gt;             &lt;b&gt;Caso:&lt;/b&gt; 6557&lt;br&gt;             &lt;br&gt;&lt;b&gt;&lt;a href=&quot;#&quot; onclick=&quot;mostrarFotos(&#x27;6557&#x27;); return false;&quot; style=&quot;font-size: 14px;&quot;&gt;Ver Fotos&lt;/a&gt;&lt;/b&gt;&lt;br&gt;             &lt;b&gt;Ver en Google Maps:&lt;/b&gt; &lt;a href=&quot;https://www.google.com/maps?q=-34.62289,-58.443538&quot; target=&quot;_blank&quot;&gt;Abrir&lt;/a&gt;&lt;br&gt;             &lt;br&gt;&lt;b&gt;&lt;a href=&quot;https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform&quot; target=&quot;_blank&quot; onclick=&quot;window.cerrarReclamo(&#x27;6557&#x27;);&quot; style=&quot;font-size: 14px;&quot;&gt;CERRAR RECLAMO&lt;/a&gt;&lt;/b&gt;         &lt;/div&gt;" data-comuna="6" data-caso="6557" data-ot="Pedido a ADM">ALBERDI, JUAN BAUTISTA AV. 1091</li>
<li data-lat="-34.564505" data-lng="-58.504789" data-popup="&lt;div style=&#x27;width: 200px; font: 12px Arial;&#x27; data-caso=&quot;6568&quot; data-comuna=&quot;12&quot;&gt;             &lt;b&gt;Dirección:&lt;/b&gt; Carlos E. Pellegrini 6030&lt;br&gt;             &lt;b&gt;Comuna:&lt;/b&gt; 12&lt;br&gt;             &lt;b&gt;OT:&lt;/b&gt; ICD30313541 &lt;br&gt;             &lt;b&gt;Observaciones:&lt;/b&gt;&lt;br&gt;Tendido a muy baja altura se solicita retiro o levantarlo&lt;br&gt;             &lt;hr style=&quot;margin: 3px 0;&quot;&gt;             &lt;b&gt;Operación:&lt;/b&gt; Paternal&lt;br&gt;             &lt;b&gt;Zona:&lt;/b&gt; Capital Norte&lt;br&gt;                          &lt;hr style=&quot;margin: 3px 0;&quot;&gt;             &lt;b&gt;Caso:&lt;/b&gt; 6568&lt;br&gt;             &lt;br&gt;&lt;b&gt;&lt;a href=&quot;#&quot; onclick=&quot;mostrarFotos(&#x27;6568&#x27;); return false;&quot; style=&quot;font-size: 14px;&quot;&gt;Ver Fotos&lt;/a&gt;&lt;/b&gt;&lt;br&gt;             &lt;b&gt;Ver en Google Maps:&lt;/b&gt; &lt;a href=&quot;https://www.google.com/maps?q=-34.564505,-58.504789&quot; target=&quot;_blank&quot;&gt;Abrir&lt;/a&gt;&lt;br&gt;             &lt;br&gt;&lt;b&gt;&lt;a href=&quot;https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform&quot; target=&quot;_blank&quot; onclick=&quot;window.cerrarReclamo(&#x27;6568&#x27;);&quot; style=&quot;font-size: 14px;&quot;&gt;CERRAR RECLAMO&lt;/a&gt;&lt;/b&gt;         &lt;/div&gt;" data-comuna="12" data-caso="6568" data-ot="ICD30313541 ">Carlos E. Pellegrini 6030</li>
<li data-lat="-34.628022" data-lng="-58.476505" data-popup="&lt;div style=&#x27;width: 200px; font: 12px Arial;&#x27; data-caso=&quot;6569&quot; data-comuna=&quot;10&quot;&gt;             &lt;b&gt;Dirección:&lt;/b&gt; CAMPANA 382&lt;br&gt;             &lt;b&gt;Comuna:&lt;/b&gt; 10&lt;br&gt;             &lt;b&gt;OT:&lt;/b&gt; Pendiente de ADM&lt;br&gt;             &lt;b&gt;Observaciones:&lt;/b&gt;&lt;br&gt;Tendido a baja altura&lt;br&gt;             &lt;hr style=&quot;margin: 3px 0;&quot;&gt;             &lt;b&gt;Operación:&lt;/b&gt; Devoto&lt;br&gt;             &lt;b&gt;Zona:&lt;/b&gt; Capital Norte&lt;br&gt;                          &lt;hr style=&quot;margin: 3px 0;&quot;&gt;             &lt;b&gt;Caso:&lt;/b&gt; 6569&lt;br&gt;             &lt;br&gt;&lt;b&gt;&lt;a href=&quot;#&quot; onclick=&quot;mostrarFotos(&#x27;6569&#x27;); return false;&quot; style=&quot;font-size: 14px;&quot;&gt;Ver Fotos&lt;/a&gt;&lt;/b&gt;&lt;br&gt;             &lt;b&gt;Ver en Google Maps:&lt;/b&gt; &lt;a href=&quot;https://www.google.com/maps?q=-34.628022,-58.476505&quot; target=&quot;_blank&quot;&gt;Abrir&lt;/a&gt;&lt;br&gt;             &lt;br&gt;&lt;b&gt;&lt;a href=&quot;https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform&quot; target=&quot;_blank&quot; onclick=&quot;window.cerrarReclamo(&#x27;6569&#x27;);&quot; style=&quot;font-size: 14px;&quot;&gt;CERRAR RECLAMO&lt;/a&gt;&lt;/b&gt;         &lt;/div&gt;" data-comuna="10" data-caso="6569" data-ot="Pendiente de ADM">CAMPANA 382</li></ul>
        </div>
        <div id="no-mapeadas-panel">
          <div id="no-mapeadas-header">
            <svg id="no-mapeadas-arrow" width="14" height="14" viewBox="0 0 24 24">
              <path fill="currentColor" d="M10 17l5-5-5-5v10z"/>
            </svg> Direcciones No Mapeadas <span>(0)</span>
          </div>
          <input id="no-mapeadas-search" placeholder="Buscar..." type="text">
          <ul id="no-mapeadas-list"></ul>
        </div>
        <div id="fotos-panel">
          <div id="fotos-header">
          <a id="fotos-header-link" href="#" onclick="window.openFotosDrive(event)" style="font: bold 14px Arial; text-decoration: underline; color: red;">Fotos del Reclamo - Tocar aquí para ver en Drive</a>            <span id="fotos-close">✖</span>
          </div>
          <div id="fotos-content"></div>
        </div>
        <div id="fotos-viewer">
          <img id="fotos-viewer-img" src="">
          <span id="fotos-viewer-close">✖</span>
        </div>
        <div id="comparison-divider"></div>
        <div id="locate-me-btn" title="Centrar en mi ubicación">📍</div>
        <div id="toggle-theme-btn" title="Cambiar tema">🌙</div>
        <div id="export-excel-btn" title="Exportar a Excel">📥</div>
        <div id="toggle-table-btn" title="Ver tabla">📋</div>
        <div id="reset-closed-btn" title="Restablecer casos cerrados">🔄</div>
        <div id="toggle-route-btn" title="Mostrar/Ocultar Recorrido">🛤️</div>
        <div id="toggle-pending-btn" title="Mostrar/Ocultar Direcciones Pendientes">📌</div>
        <div id="toggle-no-mapeadas-btn" title="Mostrar/Ocultar Direcciones No Mapeadas">⚠️</div>
        <div id="table-panel">
          <div id="table-header">
            <span>Lista Completa de Direcciones</span>
            <span id="table-close">✖</span>
          </div>
          <div id="table-body">
            <table>
              <thead>
                <tr>
                  <th>Dirección</th>
                  <th>Comuna</th>
                  <th>Caso</th>
                  <th>OT</th>
                </tr>
              </thead>
              <tbody id="table-rows"></tbody>
            </table>
          </div>
        </div>
        
</body>
<script>
    
    
            var map_668f89319b27fe6ccb41764899ce32f6 = L.map(
                "map_668f89319b27fe6ccb41764899ce32f6",
                {
                    center: [-34.6037, -58.3816],
                    crs: L.CRS.EPSG3857,
                    ...{
  "zoom": 12,
  "zoomControl": true,
  "preferCanvas": false,
}

                }
            );

            

        
    
            var tile_layer_a3263c17eba7b99680c5efd3943d67f9 = L.tileLayer(
                "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
                {
  "minZoom": 0,
  "maxZoom": 19,
  "maxNativeZoom": 19,
  "noWrap": false,
  "attribution": "\u0026copy; \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors",
  "subdomains": "abc",
  "detectRetina": false,
  "tms": false,
  "opacity": 1,
}

            );
        
    
            tile_layer_a3263c17eba7b99680c5efd3943d67f9.addTo(map_668f89319b27fe6ccb41764899ce32f6);
        
    
            var marker_cluster_11d019588279f3d88c2d4589711fd02b = L.markerClusterGroup(
                {
  "spiderfyOnMaxZoom": true,
  "showCoverageOnHover": true,
  "zoomToBoundsOnClick": true,
  "disableClusteringAtZoom": 15,
}
            );
        
    
            var marker_76204a2057cde26e1b172400c0a3eb1a = L.marker(
                [-34.588033, -58.417181],
                {
}
            ).addTo(marker_cluster_11d019588279f3d88c2d4589711fd02b);
        
    
            var icon_1cf1f8a6d4928516a7e833734057bdea = L.AwesomeMarkers.icon(
                {
  "markerColor": "blue",
  "iconColor": "white",
  "icon": "info-sign",
  "prefix": "glyphicon",
  "extraClasses": "fa-rotate-0",
}
            );
        
    
        var popup_229e392278a82ca0cb9321cc4a658f2b = L.popup({
  "maxWidth": 200,
});

        
            
                var html_c475db849be6357da07dd02b787acbd9 = $(`<div id="html_c475db849be6357da07dd02b787acbd9" style="width: 100.0%; height: 100.0%;">         <div style='width: 200px; font: 12px Arial;' data-caso="5862" data-comuna="14">             <b>Dirección:</b> CHARCAS 3715<br>             <b>Comuna:</b> 14<br>             <b>OT:</b> 806976061<br>             <b>Observaciones:</b><br>Cable en panza Cable cortado<br>             <hr style="margin: 3px 0;">             <b>Operación:</b> Palermo<br>             <b>Zona:</b> Capital Sur<br>                          <hr style="margin: 3px 0;">             <b>Caso:</b> 5862<br>             <br><b><a href="#" onclick="mostrarFotos('5862'); return false;" style="font-size: 14px;">Ver Fotos</a></b><br>             <b>Ver en Google Maps:</b> <a href="https://www.google.com/maps?q=-34.588033,-58.417181" target="_blank">Abrir</a><br>             <br><b><a href="https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform" target="_blank" onclick="window.cerrarReclamo('5862');" style="font-size: 14px;">CERRAR RECLAMO</a></b>         </div>         </div>`)[0];
                popup_229e392278a82ca0cb9321cc4a658f2b.setContent(html_c475db849be6357da07dd02b787acbd9);
            
        

        marker_76204a2057cde26e1b172400c0a3eb1a.bindPopup(popup_229e392278a82ca0cb9321cc4a658f2b)
        ;

        
    
    
                marker_76204a2057cde26e1b172400c0a3eb1a.setIcon(icon_1cf1f8a6d4928516a7e833734057bdea);
            
    
            var marker_8201997f1cf6232ae35d5efa53397788 = L.marker(
                [-34.579243, -58.512533],
                {
}
            ).addTo(marker_cluster_11d019588279f3d88c2d4589711fd02b);
        
    
            var icon_ddb2023b466b804634a00baedbdc6008 = L.AwesomeMarkers.icon(
                {
  "markerColor": "blue",
  "iconColor": "white",
  "icon": "info-sign",
  "prefix": "glyphicon",
  "extraClasses": "fa-rotate-0",
}
            );
        
    
        var popup_cf1dc1f16a69a69647dfa2bc6c387fe0 = L.popup({
  "maxWidth": 200,
});

        
            
                var html_f12c4b3cbcb8ff5054d315bec7568ff5 = $(`<div id="html_f12c4b3cbcb8ff5054d315bec7568ff5" style="width: 100.0%; height: 100.0%;">         <div style='width: 200px; font: 12px Arial;' data-caso="5894" data-comuna="12">             <b>Dirección:</b> ALBARELLOS AV. 3100<br>             <b>Comuna:</b> 12<br>             <b>OT:</b> 807045500<br>             <b>Observaciones:</b><br>No coinciden las fotos cargadas en el form con el reclamo original<br>             <hr style="margin: 3px 0;">             <b>Operación:</b> Paternal<br>             <b>Zona:</b> Capital Norte<br>                          <hr style="margin: 3px 0;">             <b>Caso:</b> 5894<br>             <br><b><a href="#" onclick="mostrarFotos('5894'); return false;" style="font-size: 14px;">Ver Fotos</a></b><br>             <b>Ver en Google Maps:</b> <a href="https://www.google.com/maps?q=-34.579243,-58.512533" target="_blank">Abrir</a><br>             <br><b><a href="https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform" target="_blank" onclick="window.cerrarReclamo('5894');" style="font-size: 14px;">CERRAR RECLAMO</a></b>         </div>         </div>`)[0];
                popup_cf1dc1f16a69a69647dfa2bc6c387fe0.setContent(html_f12c4b3cbcb8ff5054d315bec7568ff5);
            
        

        marker_8201997f1cf6232ae35d5efa53397788.bindPopup(popup_cf1dc1f16a69a69647dfa2bc6c387fe0)
        ;

        
    
    
                marker_8201997f1cf6232ae35d5efa53397788.setIcon(icon_ddb2023b466b804634a00baedbdc6008);
            
    
            var marker_445390765cdcdf237c53707ba0afbae9 = L.marker(
                [-34.580805, -58.431302],
                {
}
            ).addTo(marker_cluster_11d019588279f3d88c2d4589711fd02b);
        
    
            var icon_561eed074f4636f27e98705122c7100c = L.AwesomeMarkers.icon(
                {
  "markerColor": "blue",
  "iconColor": "white",
  "icon": "info-sign",
  "prefix": "glyphicon",
  "extraClasses": "fa-rotate-0",
}
            );
        
    
        var popup_99418a1c2ebf6facdd3deee8c5251489 = L.popup({
  "maxWidth": 200,
});

        
            
                var html_d97a169facbd4c9a0acbf9716d3f5be6 = $(`<div id="html_d97a169facbd4c9a0acbf9716d3f5be6" style="width: 100.0%; height: 100.0%;">         <div style='width: 200px; font: 12px Arial;' data-caso="4238" data-comuna="14">             <b>Dirección:</b> GUATEMALA 5527<br>             <b>Comuna:</b> 14<br>             <b>OT:</b> 807130137<br>             <b>Observaciones:</b><br>Las fotos que cargaron en el form no coinciden con las originales<br>             <hr style="margin: 3px 0;">             <b>Operación:</b> Palermo<br>             <b>Zona:</b> Capital Sur<br>                          <hr style="margin: 3px 0;">             <b>Caso:</b> 4238<br>             <br><b><a href="#" onclick="mostrarFotos('4238'); return false;" style="font-size: 14px;">Ver Fotos</a></b><br>             <b>Ver en Google Maps:</b> <a href="https://www.google.com/maps?q=-34.580805,-58.431302" target="_blank">Abrir</a><br>             <br><b><a href="https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform" target="_blank" onclick="window.cerrarReclamo('4238');" style="font-size: 14px;">CERRAR RECLAMO</a></b>         </div>         </div>`)[0];
                popup_99418a1c2ebf6facdd3deee8c5251489.setContent(html_d97a169facbd4c9a0acbf9716d3f5be6);
            
        

        marker_445390765cdcdf237c53707ba0afbae9.bindPopup(popup_99418a1c2ebf6facdd3deee8c5251489)
        ;

        
    
    
                marker_445390765cdcdf237c53707ba0afbae9.setIcon(icon_561eed074f4636f27e98705122c7100c);
            
    
            var marker_1fa4ec0f44b00de1c001e2be9e972fea = L.marker(
                [-34.562841, -58.440291],
                {
}
            ).addTo(marker_cluster_11d019588279f3d88c2d4589711fd02b);
        
    
            var icon_acac8cbbaef5de928256eca02b4f0eeb = L.AwesomeMarkers.icon(
                {
  "markerColor": "blue",
  "iconColor": "white",
  "icon": "info-sign",
  "prefix": "glyphicon",
  "extraClasses": "fa-rotate-0",
}
            );
        
    
        var popup_205d49503e21b6e6ab1caefdd328a17a = L.popup({
  "maxWidth": 200,
});

        
            
                var html_af6e08c5f5b10f4b55d38640b400d52b = $(`<div id="html_af6e08c5f5b10f4b55d38640b400d52b" style="width: 100.0%; height: 100.0%;">         <div style='width: 200px; font: 12px Arial;' data-caso="6262" data-comuna="14">             <b>Dirección:</b> MIGUELETES 1330<br>             <b>Comuna:</b> 14<br>             <b>OT:</b> 807789707<br>             <b>Observaciones:</b><br>Cables en panza<br>             <hr style="margin: 3px 0;">             <b>Operación:</b> Colegiales<br>             <b>Zona:</b> Capital Norte<br>                          <hr style="margin: 3px 0;">             <b>Caso:</b> 6262<br>             <br><b><a href="#" onclick="mostrarFotos('6262'); return false;" style="font-size: 14px;">Ver Fotos</a></b><br>             <b>Ver en Google Maps:</b> <a href="https://www.google.com/maps?q=-34.562841,-58.440291" target="_blank">Abrir</a><br>             <br><b><a href="https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform" target="_blank" onclick="window.cerrarReclamo('6262');" style="font-size: 14px;">CERRAR RECLAMO</a></b>         </div>         </div>`)[0];
                popup_205d49503e21b6e6ab1caefdd328a17a.setContent(html_af6e08c5f5b10f4b55d38640b400d52b);
            
        

        marker_1fa4ec0f44b00de1c001e2be9e972fea.bindPopup(popup_205d49503e21b6e6ab1caefdd328a17a)
        ;

        
    
    
                marker_1fa4ec0f44b00de1c001e2be9e972fea.setIcon(icon_acac8cbbaef5de928256eca02b4f0eeb);
            
    
            var marker_97e33c83bb7a415e64c9187f7c50da63 = L.marker(
                [-34.62289, -58.443538],
                {
}
            ).addTo(marker_cluster_11d019588279f3d88c2d4589711fd02b);
        
    
            var icon_a95fa90c71ba4670cf1ffb7deb6e2522 = L.AwesomeMarkers.icon(
                {
  "markerColor": "blue",
  "iconColor": "white",
  "icon": "info-sign",
  "prefix": "glyphicon",
  "extraClasses": "fa-rotate-0",
}
            );
        
    
        var popup_7ba50cba32e4387450fffa2d665da426 = L.popup({
  "maxWidth": 248,
});

        
            
                var html_7c561c338bd5a8707d63c81441076572 = $(`<div id="html_7c561c338bd5a8707d63c81441076572" style="width: 100.0%; height: 100.0%;">         <div style='width: 248px; font: 12px Arial;' data-caso="6557" data-comuna="6">             <b>Dirección:</b> ALBERDI, JUAN BAUTISTA AV. 1091<br>             <b>Comuna:</b> 6<br>             <b>OT:</b> Pedido a ADM<br>             <b>Observaciones:</b><br>Verificar si la linga panseada es nuestra y ver con pablo como resolverlo<br>             <hr style="margin: 3px 0;">             <b>Operación:</b> Boedo<br>             <b>Zona:</b> Capital Sur<br>                          <hr style="margin: 3px 0;">             <b>Caso:</b> 6557<br>             <br><b><a href="#" onclick="mostrarFotos('6557'); return false;" style="font-size: 14px;">Ver Fotos</a></b><br>             <b>Ver en Google Maps:</b> <a href="https://www.google.com/maps?q=-34.62289,-58.443538" target="_blank">Abrir</a><br>             <br><b><a href="https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform" target="_blank" onclick="window.cerrarReclamo('6557');" style="font-size: 14px;">CERRAR RECLAMO</a></b>         </div>         </div>`)[0];
                popup_7ba50cba32e4387450fffa2d665da426.setContent(html_7c561c338bd5a8707d63c81441076572);
            
        

        marker_97e33c83bb7a415e64c9187f7c50da63.bindPopup(popup_7ba50cba32e4387450fffa2d665da426)
        ;

        
    
    
                marker_97e33c83bb7a415e64c9187f7c50da63.setIcon(icon_a95fa90c71ba4670cf1ffb7deb6e2522);
            
    
            var marker_01f533d849efddc829d84d60ed8b761e = L.marker(
                [-34.564505, -58.504789],
                {
}
            ).addTo(marker_cluster_11d019588279f3d88c2d4589711fd02b);
        
    
            var icon_23aff3fbf3cea23ee1e9b8b5f245ffc2 = L.AwesomeMarkers.icon(
                {
  "markerColor": "blue",
  "iconColor": "white",
  "icon": "info-sign",
  "prefix": "glyphicon",
  "extraClasses": "fa-rotate-0",
}
            );
        
    
        var popup_9cfc8ae963617d23213dc4c1a7f49d20 = L.popup({
  "maxWidth": 200,
});

        
            
                var html_b54cddf2449056ec75d6e0888e7484ae = $(`<div id="html_b54cddf2449056ec75d6e0888e7484ae" style="width: 100.0%; height: 100.0%;">         <div style='width: 200px; font: 12px Arial;' data-caso="6568" data-comuna="12">             <b>Dirección:</b> Carlos E. Pellegrini 6030<br>             <b>Comuna:</b> 12<br>             <b>OT:</b> ICD30313541 <br>             <b>Observaciones:</b><br>Tendido a muy baja altura se solicita retiro o levantarlo<br>             <hr style="margin: 3px 0;">             <b>Operación:</b> Paternal<br>             <b>Zona:</b> Capital Norte<br>                          <hr style="margin: 3px 0;">             <b>Caso:</b> 6568<br>             <br><b><a href="#" onclick="mostrarFotos('6568'); return false;" style="font-size: 14px;">Ver Fotos</a></b><br>             <b>Ver en Google Maps:</b> <a href="https://www.google.com/maps?q=-34.564505,-58.504789" target="_blank">Abrir</a><br>             <br><b><a href="https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform" target="_blank" onclick="window.cerrarReclamo('6568');" style="font-size: 14px;">CERRAR RECLAMO</a></b>         </div>         </div>`)[0];
                popup_9cfc8ae963617d23213dc4c1a7f49d20.setContent(html_b54cddf2449056ec75d6e0888e7484ae);
            
        

        marker_01f533d849efddc829d84d60ed8b761e.bindPopup(popup_9cfc8ae963617d23213dc4c1a7f49d20)
        ;

        
    
    
                marker_01f533d849efddc829d84d60ed8b761e.setIcon(icon_23aff3fbf3cea23ee1e9b8b5f245ffc2);
            
    
            var marker_28b7169125395840a9cf8c7d09600be9 = L.marker(
                [-34.628022, -58.476505],
                {
}
            ).addTo(marker_cluster_11d019588279f3d88c2d4589711fd02b);
        
    
            var icon_5bd1f4f0f8aedbf78232f4eb0eb4f8d3 = L.AwesomeMarkers.icon(
                {
  "markerColor": "blue",
  "iconColor": "white",
  "icon": "info-sign",
  "prefix": "glyphicon",
  "extraClasses": "fa-rotate-0",
}
            );
        
    
        var popup_b693578b81d820a15d912690ef19736f = L.popup({
  "maxWidth": 200,
});

        
            
                var html_d62d3f2c97cacf9b1dc2e70173c5a102 = $(`<div id="html_d62d3f2c97cacf9b1dc2e70173c5a102" style="width: 100.0%; height: 100.0%;">         <div style='width: 200px; font: 12px Arial;' data-caso="6569" data-comuna="10">             <b>Dirección:</b> CAMPANA 382<br>             <b>Comuna:</b> 10<br>             <b>OT:</b> Pendiente de ADM<br>             <b>Observaciones:</b><br>Tendido a baja altura<br>             <hr style="margin: 3px 0;">             <b>Operación:</b> Devoto<br>             <b>Zona:</b> Capital Norte<br>                          <hr style="margin: 3px 0;">             <b>Caso:</b> 6569<br>             <br><b><a href="#" onclick="mostrarFotos('6569'); return false;" style="font-size: 14px;">Ver Fotos</a></b><br>             <b>Ver en Google Maps:</b> <a href="https://www.google.com/maps?q=-34.628022,-58.476505" target="_blank">Abrir</a><br>             <br><b><a href="https://docs.google.com/forms/d/e/1FAIpQLScuxwrARuhy8VBZMn7fNon_ThghC57SwZUb69NAphF7Bwn29g/viewform" target="_blank" onclick="window.cerrarReclamo('6569');" style="font-size: 14px;">CERRAR RECLAMO</a></b>         </div>         </div>`)[0];
                popup_b693578b81d820a15d912690ef19736f.setContent(html_d62d3f2c97cacf9b1dc2e70173c5a102);
            
        

        marker_28b7169125395840a9cf8c7d09600be9.bindPopup(popup_b693578b81d820a15d912690ef19736f)
        ;

        
    
    
                marker_28b7169125395840a9cf8c7d09600be9.setIcon(icon_5bd1f4f0f8aedbf78232f4eb0eb4f8d3);
            
    
            marker_cluster_11d019588279f3d88c2d4589711fd02b.addTo(map_668f89319b27fe6ccb41764899ce32f6);
        
</script>
</html>